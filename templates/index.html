<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ì—°ê²° -->
    <link rel="manifest" href="manifest.json" />
    <!-- Google Fonts ì¶”ê°€ -->
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap');

body {
    position: relative;
    height: 100vh;
    margin: 0;
    background-color: #f7f7f7;
    background-image: url(static/img/dddd.png);
    background-size: 70%;
    background-repeat: no-repeat;
    background-position: center;
    font-family: 'Noto Sans KR', sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

/* í™”ë©´ í¬ê¸°ê°€ 1024px ì´ìƒì¼ ë•Œ (PC í™˜ê²½) */
@media screen and (min-width: 1024px) {
    body {
        background-size: 30%; /* ì´ë¯¸ì§€ë¥¼ ë” ì‘ê²Œ ì¡°ì • */
    }
}

/* í™”ë©´ í¬ê¸°ê°€ 600px ì´í•˜ì¼ ë•Œ (ëª¨ë°”ì¼ í™˜ê²½) */
@media screen and (max-width: 600px) {
    body {
        background-size: 70%; /* ëª¨ë°”ì¼ì—ì„œëŠ” ê¸°ì¡´ ì„¤ì • ìœ ì§€ */
    }
}
#visitor-counter {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    position: absolute;
    top: 45px; /* íƒ€ì´í‹€ë°” ë°”ë¡œ ì•„ë˜ì— ìœ„ì¹˜ */
    right: 15px;
    background: rgba(255, 255, 255, 0.9); /* ë°°ê²½ íˆ¬ëª…ë„ ì¡°ì ˆ */
    padding: 8px 15px;
    border-radius: 12px;
    font-size: 0.7em;
    font-weight: bold;
    color: #000;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); /* ê·¸ë¦¼ì ì¶”ê°€ */
    z-index: 1000; /* í•­ìƒ ìœ„ìª½ì— ìœ„ì¹˜ */
    white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
}


#title-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(to right, #a7ceee, #1077dd); /* ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì ì  ì§„í•´ì§ */
    color: #3B1E1E;
    border-radius: 20px;
    padding: 10px 0;
    font-size: 1.2em;
    font-weight: bold;
    z-index: 1000;
    display: flex;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    height: 34px; /* íƒ€ì´í‹€ë°”ì˜ ë†’ì´ë¥¼ ê³ ì • */
}

#title-bar #logo {
    position: relative;
    height: 50px; /* ë¡œê³  í¬ê¸°ë¥¼ ì—¬ê¸°ì„œ ì¡°ì • */
    width: auto; /* ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©´ì„œ í¬ê¸° ì¡°ì • */
    margin-left: 10px;
}

#title-bar #title-text {
    flex-grow: 1;
    text-align: center;
    margin-left: -40px;
    font-size: 1.0em; /* í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
}

#title-bar img {
    height: 100%; /* ë¡œê³  ì´ë¯¸ì§€ê°€ íƒ€ì´í‹€ë°” ë†’ì´ì— ë§ê²Œ í¬ê¸° ì¡°ì • */
    width: auto;
}
    #chat-box {
        position: fixed;
        top: 60px;
        bottom: 120px; /* ì…ë ¥ì°½ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ bottom ì„¤ì • */
        width: 100%;
        background-color: transparent;
        display: flex;
        flex-direction: column;
        overflow-y: auto; /* ìŠ¤í¬ë¡¤ì´ í•„ìš”í•œ ìš”ì†Œ */
    }

    #messages {
        padding: 10px;
        flex-grow: 1; /* ë©”ì‹œì§€ ì˜ì—­ì´ ë‚¨ì€ ê³µê°„ì„ ì°¨ì§€í•˜ë„ë¡ */
        display: flex;
        flex-direction: column;
        justify-content: flex-start; /* ë©”ì‹œì§€ë“¤ì´ ìœ„ì—ì„œë¶€í„° ì‹œì‘í•˜ë„ë¡ */
    }

    /* ì²« ë²ˆì§¸ ë©”ì‹œì§€ ìœ„ì— ê³µê°„ ì¶”ê°€ */
    .message-container:first-child {
        margin-top: 20px;
    }

    .message-container {
        display: flex;
        align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ */
        margin: 5px 0;
    }

    .message-container.bard-container {
        justify-content: flex-start; /* ì•„ë°”íƒ€ì™€ ë©”ì‹œì§€ë¥¼ ì™¼ìª½ ì •ë ¬ */
    }

    .message-container.user-container {
        justify-content: flex-end; /* ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ì˜¤ë¥¸ìª½ ì •ë ¬ */
    }

    .bard {
        display: flex;
        flex-direction: column;
        align-items: flex-start; /* ì™¼ìª½ ì •ë ¬ */
    }

    .user {
        display: flex;
        flex-direction: column;
        align-items: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
    }

    .message-name {
        font-size: 0.8em;
        color: #555555;
        margin-bottom: 3px;
    }

    .avatar {
        width: 60px;
        height: 60px;
        border-radius: 38px;
        margin-right: 5px;
        margin-top: 3px;
    }

    .message-content {
    max-width: 70%;
    word-wrap: break-word;
    padding: 8px 12px;
    border-radius: 18px;
    font-size: 0.95em;
    position: relative;
    line-height: 1.4;
    box-shadow: 4px 4px 6px rgba(0, 0, 0, 0.1); /* íë¦¿í•œ ê·¸ë¦¼ì ì¶”ê°€ */
}

.bard .message-content {
    background-color: #FFFFFF;
    color: #000000;
    border: 1px solid #E5E5E5;
    box-shadow: 4px 4px 6px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì ì¶”ê°€ */
}

.user .message-content {
    background-color: #CEF5CE;
    color: #000000;
    box-shadow: 4px 4px 6px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì ì¶”ê°€ */
}

    /* ë§í’ì„  ê¼¬ë¦¬ ì¶”ê°€ */
    .bard .message-content::after {
        content: "";
        position: absolute;
        top: 12px; /* ìœ„ì¹˜ ì¡°ì • */
        left: -6px;
        border-width: 6px 6px 6px 0;
        border-style: solid;
        border-color: transparent #FFFFFF transparent transparent;
    }

    .user .message-content::after {
        content: "";
        position: absolute;
        top: 12px; /* ìœ„ì¹˜ ì¡°ì • */
        right: -6px;
        border-width: 6px 0 6px 6px;
        border-style: solid;
        border-color: transparent transparent transparent #CEF5CE;
    }

    /* ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ìœ ì§€ */

    #mic-button, .question-slider button, #chat-form input[type="submit"] {
        background-color: transparent;
        color: #3B1E1E;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 1.2em;
    }

    #mic-button:active, .question-slider button:active, #chat-form input[type="submit"]:active {
        opacity: 0.7;
    }

    .question-slider {
        position: fixed;
        bottom: 49px;
        width: 100%;
        z-index: 1000;
        display: flex;
        overflow-x: auto;
        padding: 10px 5px;
        background-color: #F7F7F7;
        border-top: 1px solid #E5E5E5;
    }

    .question-slider button {
        flex: 0 0 auto;
        margin-right: 10px;
        padding: 8px 12px;
        background-color: #FFFFFF;
        color: #000000;
        border: 1px solid #E5E5E5;
        border-radius: 18px;
        cursor: pointer;
        font-size: 0.9em;
    }

    .question-slider button:active {
        opacity: 0.7;
    }

    @media (max-width: 600px) {
        .message-content {
            font-size: 1em;
            max-width: 85%;
        }

        #chat-form input[type="text"] {
            width: calc(100% - 50px);
        }
    }

    #chat-form {
        position: fixed;
        bottom: 0;
        width: 100%;
        display: flex;
        align-items: center;
        border-top: 1px solid #E5E5E5;
        padding: 5px 10px;
        background-color: #F7F7F7;
        z-index: 1001;
    }

    #chat-form input[type="text"] {
        flex-grow: 1;
        padding: 10px 12px;
        border: none;
        border-radius: 25px;
        background-color: #FFFFFF;
        font-size: 1em;
        margin-right: 10px;
    }

    #chat-form input[type="text"]:focus {
        outline: none;
    }

    #chat-form input[type="submit"] {
        background-color: transparent;
        color: #3B1E1E;
        border: none;
        font-size: 1.5em;
    }

    .loading-message {
        display: flex;
        justify-content: center;
        align-items: center;
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 1000;
    }

    .loader {
        display: flex;
        justify-content: space-around;
        width: 40px;
    }

    .loader div {
        width: 6px;
        height: 40px;
        background-color: #3498db;
        animation: loader 1.2s infinite ease-in-out;
    }

    .loader div:nth-child(1) {
        animation-delay: -1.1s;
    }
    .loader div:nth-child(2) {
        animation-delay: -1.0s;
    }
    .loader div:nth-child(3) {
        animation-delay: -0.9s;
    }
    .loader div:nth-child(4) {
        animation-delay: -0.8s;
    }
    .loader div:nth-child(5) {
        animation-delay: -0.7s;
    }

    @keyframes loader {
        0%, 40%, 100% {
            transform: scaleY(0.4);
        }
        20% {
            transform: scaleY(1.0);
        }
    }
    #fact-check-button {
        margin-left: auto;
        background-color: transparent;
        color: #3B1E1E;
        border: none;
        padding: 0;
        cursor: pointer;
        font-size: 0.8em;
    }

    #fact-check-button:hover {
        opacity: 0.7;
    }
    #splash-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #FEE500;
        z-index: 1000;
        animation: fadeOut 2s ease-in-out forwards;
    }

    #splash-screen img {
        max-width: 80%;
        max-height: 80%;
    }

    @keyframes fadeOut {
        0% { opacity: 1; }
        100% { opacity: 0; visibility: hidden; }
    }
    </style>

    <script>
        let recognition;
        let isListening = false;

        function initializeRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chromeì„ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.');
                return;
            }

            if (!recognition) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'ko-KR';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = function() {
                    isListening = true;
                    var listeningMessage = document.createElement("div");
                    listeningMessage.id = "listening-message";
                    listeningMessage.textContent = "ë“£ê³  ìˆì–´ìš”...";
                    listeningMessage.className = "bard message-content";
                    document.getElementById("messages").appendChild(listeningMessage);
                    scrollToBottom();
                };

                recognition.onresult = function(event) {
                    var transcript = event.results[0][0].transcript;
                    document.getElementById("input-message").value = transcript;
                    var listeningMessage = document.getElementById("listening-message");
                    if (listeningMessage) {
                        document.getElementById("messages").removeChild(listeningMessage);
                    }
                    submitMessage();
                };

                recognition.onerror = function(event) {
                    console.error(event.error);
                    isListening = false;
                    var listeningMessage = document.getElementById("listening-message");
                    if (listeningMessage) {
                        document.getElementById("messages").removeChild(listeningMessage);
                    }
                };

                recognition.onend = function() {
                    isListening = false;
                    var listeningMessage = document.getElementById("listening-message");
                    if (listeningMessage) {
                        document.getElementById("messages").removeChild(listeningMessage);
                    }
                };
            }
        }

        function displayDefaultMessage() {
            var defaultMsg = "ì•ˆë…•í•˜ì„¸ìš”! ì²­ë ´ì±—ë´‡ â€˜í”„ë½ì‹œìŠ¤â€™ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?";

            var messageContainer = document.createElement("div");
            messageContainer.className = "message-container bard-container";

            var avatar = document.createElement("img");
            avatar.src = "static/img/sss.png"; // ì•„ë°”íƒ€ ì´ë¯¸ì§€ ê²½ë¡œ
            avatar.className = "avatar";

            var bardMessage = document.createElement("div");
            bardMessage.className = "bard";

            // ì´ë¦„ ìš”ì†Œ ì¶”ê°€
            var messageName = document.createElement("div");
            messageName.textContent = "í”„ë½ì‹œìŠ¤";
            messageName.className = "message-name";

            var messageContent = document.createElement("div");
            messageContent.textContent = defaultMsg;
            messageContent.className = "message-content";

            // ì´ë¦„ê³¼ ë©”ì‹œì§€ ë‚´ìš©ì„ bardMessageì— ì¶”ê°€
            bardMessage.appendChild(messageName);
            bardMessage.appendChild(messageContent);

            messageContainer.appendChild(avatar);
            messageContainer.appendChild(bardMessage);
            document.getElementById("messages").appendChild(messageContainer);
            scrollToBottom();
        }

        document.addEventListener("DOMContentLoaded", function() {
            setTimeout(displayDefaultMessage, 500);
            initializeRecognition();
        });

        function submitMessage(question) {
            var input = document.getElementById("input-message");
            var message = question || input.value;
            input.value = "";

            var messageContainer = document.createElement("div");
            messageContainer.className = "message-container user-container";

            var userMessage = document.createElement("div");
            userMessage.className = "user";

            var messageContent = document.createElement("div");
            messageContent.textContent = message;
            messageContent.className = "message-content";

            userMessage.appendChild(messageContent);
            messageContainer.appendChild(userMessage);
            document.getElementById("messages").appendChild(messageContainer);
            scrollToBottom();

            var loadingMessage = document.createElement("div");
            loadingMessage.className = "loading-message";
            var loader = document.createElement("div");
            loader.className = "loader";
            for (var i = 0; i < 5; i++) {
                var bar = document.createElement("div");
                loader.appendChild(bar);
            }
            loadingMessage.appendChild(loader);
            document.body.appendChild(loadingMessage);

            fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question: message })
            }).then(response => response.json())
            .then(data => {
                document.body.removeChild(loadingMessage);

                var messageContainer = document.createElement("div");
                messageContainer.className = "message-container bard-container";

                var avatar = document.createElement("img");
                avatar.src = "static/img/sss.png"; // ì•„ë°”íƒ€ ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”
                avatar.className = "avatar";

                var bardMessage = document.createElement("div");
                bardMessage.className = "bard";

                // ì´ë¦„ ìš”ì†Œ ì¶”ê°€
                var messageName = document.createElement("div");
                messageName.textContent = "í”„ë½ì‹œìŠ¤";
                messageName.className = "message-name";

                var messageContent = document.createElement("div");
                messageContent.innerHTML = data.answer;
                messageContent.className = "message-content";

                // ì´ë¦„ê³¼ ë©”ì‹œì§€ ë‚´ìš©ì„ bardMessageì— ì¶”ê°€
                bardMessage.appendChild(messageName);
                bardMessage.appendChild(messageContent);

                messageContainer.appendChild(avatar);
                messageContainer.appendChild(bardMessage);
                document.getElementById("messages").appendChild(messageContainer);
                scrollToBottom();
            });
        }

        function scrollToBottom() {
            var chatBox = document.getElementById("chat-box");
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function startRecognition() {
            if (!recognition) {
                initializeRecognition();
            }

            if (isListening) {
                recognition.stop();
                return;
            }

            recognition.start();
        }

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                document.getElementById('splash-screen').style.display = 'none';
            }, 3000);
        });
document.addEventListener("DOMContentLoaded", function () {
    console.log("ğŸš€ Fetching visitor data..."); // ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€

    fetch("/visitors")
        .then(response => {
            if (!response.ok) {
                throw new Error("Network response was not ok " + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log("âœ… Visitor Data Loaded:", data); // ë°©ë¬¸ì ë°ì´í„° í™•ì¸ìš© ë¡œê·¸
            document.getElementById("today-visitors").textContent = data.today;
            document.getElementById("total-visitors").textContent = data.total;
        })
        .catch(error => {
            console.error("âŒ Error fetching visitor data:", error);
            document.getElementById("today-visitors").textContent = "N/A";
            document.getElementById("total-visitors").textContent = "N/A";
        });
});


    </script>
</head>
  
<body>
    <div id="visitor-counter">
    <span> TODAY: <span id="today-visitors">0</span></span>
    <span> TOTAL: <span id="total-visitors">0</span></span>
</div>

    <div id="splash-screen">
        <img src="static/img/splash.png" alt="" />
    </div>

    <div id="title-bar">
        <img src="static/img/150new.png" alt="Logo" id="logo">
        <span id="title-text">ì²­ë ´ ì±—ë´‡ Praxis</span>

    </div>

    <div id="chat-box">
        <div id="messages"></div>
    </div>
    <div class="question-slider">
        <button onclick="submitMessage('ì–´ë¦°ì´ì§‘ ë³´ìœ¡êµì‚¬ê°€ ì²­íƒê¸ˆì§€ë²• ì ìš©ëŒ€ìƒì— í•´ë‹¹ë˜ëŠ”ì§€ìš”?')">ì–´ë¦°ì´ì§‘ ë³´ìœ¡êµì‚¬ë„ ì ìš©ë˜ë‚˜ìš”?</button>
        <button onclick="submitMessage('ìŠ¤ìŠ¹ì˜ ë‚  ë‹´ì„ì„ ìƒë‹˜ê»˜ ë“œë¦¬ëŠ” ì¹´ë„¤ì´ì…˜ì€ ê°€ëŠ¥í•œê°€ìš”?')">ìŠ¤ìŠ¹ì˜ ë‚  ì¹´ë„¤ì´ì…˜ ê°€ëŠ¥?</button>
        <!-- í•„ìš”í•œ ë§Œí¼ ë²„íŠ¼ ì¶”ê°€ -->
    </div>
    <form id="chat-form" onsubmit="event.preventDefault(); submitMessage()">
        <input type="text" id="input-message" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required autocomplete="off">
        <button type="button" id="mic-button" onclick="startRecognition()">ğŸ™ï¸</button>
        <input type="submit" value="â¤">
    </form>
</body>
</html> 
